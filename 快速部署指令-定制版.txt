========================================
OpenList å¿«é€Ÿéƒ¨ç½²æŒ‡ä»¤ï¼ˆå®šåˆ¶ç‰ˆï¼‰
========================================

æœåŠ¡å™¨ä¿¡æ¯ï¼š
  IP åœ°å€: 70.39.205.183
  å‰ç«¯ç«¯å£: 66
  åç«¯ç«¯å£: 5244
  éƒ¨ç½²ç›®å½•: /opt/openlist

æ–‡ä»¶ä¸Šä¼ ä½ç½®ï¼š
  âœ… /opt/openlist/openlist-backend.tar
  âœ… /opt/openlist/openlist-frontend.tar


========================================
æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆæ¨èï¼‰
========================================

æ­¥éª¤ 1ï¼šä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨
--------------------------
åœ¨æœ¬åœ° PowerShell ä¸­æ‰§è¡Œï¼š

scp 3-æœåŠ¡å™¨åŠ è½½å¹¶è¿è¡Œ-å®šåˆ¶ç‰ˆ.sh root@70.39.205.183:/opt/openlist/


æ­¥éª¤ 2ï¼šè¿æ¥æœåŠ¡å™¨å¹¶è¿è¡Œ
--------------------------
ssh root@70.39.205.183

cd /opt/openlist

chmod +x 3-æœåŠ¡å™¨åŠ è½½å¹¶è¿è¡Œ-å®šåˆ¶ç‰ˆ.sh

./3-æœåŠ¡å™¨åŠ è½½å¹¶è¿è¡Œ-å®šåˆ¶ç‰ˆ.sh


æ­¥éª¤ 3ï¼šè®¿é—®ç½‘ç«™
--------------------------
æµè§ˆå™¨æ‰“å¼€ï¼šhttp://70.39.205.183:66


========================================
æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²
========================================

æ­¥éª¤ 1ï¼šè¿æ¥æœåŠ¡å™¨
--------------------------
ssh root@70.39.205.183


æ­¥éª¤ 2ï¼šè¿›å…¥éƒ¨ç½²ç›®å½•
--------------------------
cd /opt/openlist


æ­¥éª¤ 3ï¼šæ£€æŸ¥æ–‡ä»¶
--------------------------
ls -lh openlist-*.tar

# åº”è¯¥çœ‹åˆ°ï¼š
# openlist-backend.tar
# openlist-frontend.tar


æ­¥éª¤ 4ï¼šå®‰è£… Dockerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
--------------------------
# æ£€æŸ¥ Docker
docker --version

# å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œï¼š
curl -fsSL https://get.docker.com | sh
systemctl start docker
systemctl enable docker


æ­¥éª¤ 5ï¼šåŠ è½½é•œåƒ
--------------------------
# åŠ è½½åç«¯é•œåƒï¼ˆéœ€è¦å‡ åˆ†é’Ÿï¼‰
docker load -i openlist-backend.tar

# åŠ è½½å‰ç«¯é•œåƒ
docker load -i openlist-frontend.tar

# éªŒè¯é•œåƒ
docker images | grep openlist


æ­¥éª¤ 6ï¼šåˆ›å»ºè¿è¡Œç¯å¢ƒ
--------------------------
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /opt/openlist/data

# åˆ›å»º Docker ç½‘ç»œ
docker network create openlist-network


æ­¥éª¤ 7ï¼šå¯åŠ¨åç«¯å®¹å™¨
--------------------------
docker run -d \
  --name openlist-backend \
  --network openlist-network \
  -p 5244:5244 \
  -v /opt/openlist/data:/app/data \
  --restart unless-stopped \
  openlist-backend:latest


æ­¥éª¤ 8ï¼šå¯åŠ¨å‰ç«¯å®¹å™¨ï¼ˆç«¯å£ 66ï¼‰
--------------------------
docker run -d \
  --name openlist-frontend \
  --network openlist-network \
  -p 66:80 \
  --restart unless-stopped \
  openlist-frontend:latest


æ­¥éª¤ 9ï¼šéªŒè¯éƒ¨ç½²
--------------------------
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½åœ¨è¿è¡Œ
# openlist-backend   Up X seconds   5244->5244
# openlist-frontend  Up X seconds   66->80


æ­¥éª¤ 10ï¼šé…ç½®é˜²ç«å¢™
--------------------------
# Ubuntu/Debian
ufw allow 66/tcp
ufw allow 5244/tcp

# CentOS
firewall-cmd --permanent --add-port=66/tcp
firewall-cmd --permanent --add-port=5244/tcp
firewall-cmd --reload


æ­¥éª¤ 11ï¼šæµ‹è¯•è®¿é—®
--------------------------
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:66

# æµè§ˆå™¨æ‰“å¼€
http://70.39.205.183:66


========================================
é‡è¦æé†’ï¼šé…ç½®äº‘æœåŠ¡å•†å®‰å…¨ç»„
========================================

âš ï¸  å¿…é¡»åœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°å¼€æ”¾ç«¯å£ï¼

é˜¿é‡Œäº‘/è…¾è®¯äº‘/AWS/å…¶ä»–ï¼š
1. ç™»å½•äº‘æœåŠ¡å•†æ§åˆ¶å°
2. æ‰¾åˆ°ä½ çš„æœåŠ¡å™¨
3. è¿›å…¥"å®‰å…¨ç»„"æˆ–"é˜²ç«å¢™"è®¾ç½®
4. æ·»åŠ å…¥ç«™è§„åˆ™ï¼š
   - ç«¯å£ï¼š66
   - åè®®ï¼šTCP
   - æ¥æºï¼š0.0.0.0/0ï¼ˆæˆ–æŒ‡å®šIPï¼‰
5. ä¿å­˜è§„åˆ™


========================================
éªŒè¯éƒ¨ç½²æ¸…å•
========================================

âœ… Docker å·²å®‰è£…
âœ… é•œåƒå·²åŠ è½½ï¼ˆdocker images | grep openlistï¼‰
âœ… å®¹å™¨æ­£åœ¨è¿è¡Œï¼ˆdocker psï¼‰
âœ… é˜²ç«å¢™å·²é…ç½®ï¼ˆufw status æˆ– firewall-cmd --list-allï¼‰
âœ… äº‘æœåŠ¡å•†å®‰å…¨ç»„å·²å¼€æ”¾ç«¯å£ 66
âœ… å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://70.39.205.183:66


========================================
å¸¸ç”¨ç®¡ç†å‘½ä»¤
========================================

æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š
  docker ps

æŸ¥çœ‹æ—¥å¿—ï¼š
  docker logs -f openlist-backend
  docker logs -f openlist-frontend

é‡å¯æœåŠ¡ï¼š
  docker restart openlist-backend
  docker restart openlist-frontend

åœæ­¢æœåŠ¡ï¼š
  docker stop openlist-backend openlist-frontend

å¯åŠ¨æœåŠ¡ï¼š
  docker start openlist-backend openlist-frontend

æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ï¼š
  docker inspect openlist-backend
  docker inspect openlist-frontend

è¿›å…¥å®¹å™¨ï¼š
  docker exec -it openlist-backend sh
  docker exec -it openlist-frontend sh


========================================
æ•°æ®å¤‡ä»½
========================================

å¤‡ä»½æ•°æ®ï¼š
  cd /opt/openlist
  tar -czf backup-$(date +%Y%m%d).tar.gz data/

ä¸‹è½½å¤‡ä»½åˆ°æœ¬åœ°ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰ï¼š
  scp root@70.39.205.183:/opt/openlist/backup-*.tar.gz ./


========================================
æ•…éšœæ’æŸ¥
========================================

é—®é¢˜ 1ï¼šæ— æ³•è®¿é—® http://70.39.205.183:66
-----------------------------------------
æ£€æŸ¥æ­¥éª¤ï¼š
1. å®¹å™¨æ˜¯å¦è¿è¡Œï¼Ÿ
   docker ps | grep openlist-frontend
   
2. ç«¯å£æ˜¯å¦ç›‘å¬ï¼Ÿ
   netstat -tulpn | grep :66
   
3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼Ÿ
   ufw status | grep 66
   
4. äº‘æœåŠ¡å•†å®‰å…¨ç»„æ˜¯å¦é…ç½®ï¼Ÿ
   åœ¨æ§åˆ¶å°æ£€æŸ¥
   
5. æœ¬åœ°æµ‹è¯•ï¼Ÿ
   curl http://localhost:66


é—®é¢˜ 2ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥
-----------------------------------------
æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š
  docker logs openlist-backend
  docker logs openlist-frontend

å¸¸è§åŸå› ï¼š
- ç«¯å£è¢«å ç”¨ï¼ˆnetstat -tulpn | grep 66ï¼‰
- é•œåƒåŠ è½½å¤±è´¥ï¼ˆdocker imagesï¼‰
- æƒé™é—®é¢˜ï¼ˆéœ€è¦ rootï¼‰


é—®é¢˜ 3ï¼šå‰ç«¯æ˜¾ç¤ºç©ºç™½æˆ– 502
-----------------------------------------
1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸ï¼š
   docker logs openlist-backend
   curl http://localhost:5244/api/public/settings

2. æ£€æŸ¥å®¹å™¨ç½‘ç»œï¼š
   docker network inspect openlist-network

3. é‡å¯å®¹å™¨ï¼š
   docker restart openlist-backend openlist-frontend


é—®é¢˜ 4ï¼šç«¯å£ 66 è¢«å ç”¨
-----------------------------------------
# æŸ¥çœ‹å ç”¨æƒ…å†µ
netstat -tulpn | grep :66

# æ–¹æ¡ˆ 1ï¼šåœæ­¢å ç”¨è¿›ç¨‹
kill -9 è¿›ç¨‹ID

# æ–¹æ¡ˆ 2ï¼šæ›´æ¢ç«¯å£ï¼ˆå¦‚æ”¹ä¸º 67ï¼‰
docker stop openlist-frontend
docker rm openlist-frontend
docker run -d \
  --name openlist-frontend \
  --network openlist-network \
  -p 67:80 \
  --restart unless-stopped \
  openlist-frontend:latest


========================================
å®Œæ•´é‡æ–°éƒ¨ç½²
========================================

å¦‚æœéœ€è¦å®Œå…¨é‡æ–°éƒ¨ç½²ï¼š

# 1. åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop openlist-backend openlist-frontend
docker rm openlist-backend openlist-frontend

# 2. åˆ é™¤é•œåƒï¼ˆå¯é€‰ï¼‰
docker rmi openlist-backend:latest openlist-frontend:latest

# 3. é‡æ–°åŠ è½½é•œåƒ
docker load -i openlist-backend.tar
docker load -i openlist-frontend.tar

# 4. é‡æ–°å¯åŠ¨ï¼ˆæ‰§è¡Œæ­¥éª¤ 7 å’Œ 8ï¼‰


========================================
æ›´æ–°éƒ¨ç½²
========================================

å½“æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼š

1. ä¸Šä¼ æ–°çš„ tar æ–‡ä»¶åˆ° /opt/openlist
2. è¿è¡Œæ›´æ–°è„šæœ¬æˆ–æ‰‹åŠ¨æ‰§è¡Œï¼š
   - åœæ­¢å®¹å™¨
   - åˆ é™¤æ—§é•œåƒ
   - åŠ è½½æ–°é•œåƒ
   - å¯åŠ¨å®¹å™¨


========================================
è®¿é—®åœ°å€æ±‡æ€»
========================================

å‰ç«¯ï¼šhttp://70.39.205.183:66
åç«¯ APIï¼šhttp://70.39.205.183:5244
æ•°æ®ç›®å½•ï¼š/opt/openlist/data


========================================
è·å–å¸®åŠ©
========================================

- æŸ¥çœ‹æ—¥å¿—ï¼šdocker logs -f openlist-backend
- æŸ¥çœ‹æ–‡æ¡£ï¼šDockeréƒ¨ç½²å®Œæ•´æµç¨‹.md
- GitHubï¼šhttps://github.com/OpenListTeam/OpenList/issues


========================================
é¦–æ¬¡ä½¿ç”¨
========================================

1. æµè§ˆå™¨æ‰“å¼€ï¼šhttp://70.39.205.183:66
2. åˆ›å»ºç®¡ç†å‘˜è´¦å·
3. ç™»å½•ç³»ç»Ÿ
4. å¼€å§‹ä½¿ç”¨

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€

