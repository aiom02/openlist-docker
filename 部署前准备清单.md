# 📋 部署前准备清单

在运行部署脚本之前，请确保以下条件都满足：

## 1️⃣ 服务器准备 ✅

### 服务器信息
- **IP 地址**: 70.39.205.183
- **SSH 端口**: 22（默认）
- **用户名**: root（或其他有 sudo 权限的用户）
- **密码**: ❓ 你需要知道密码！

### 检查 SSH 连接

**在部署前，先测试能否连接服务器：**

```bash
# Windows PowerShell 或 CMD
ssh root@70.39.205.183

# 如果提示输入密码，输入后能成功登录，说明连接正常
# 按 Ctrl+D 或输入 exit 退出
```

如果无法连接，可能的原因：
- ❌ 服务器 IP 不正确
- ❌ 服务器防火墙阻止了 SSH（端口 22）
- ❌ 用户名或密码不正确
- ❌ 网络无法访问服务器

---

## 2️⃣ 本地开发环境 ✅

### Windows 必须的工具

**检查是否已安装：**

```powershell
# 在 PowerShell 或 CMD 中运行这些命令

# 1. 检查 Node.js
node --version
# 应该显示: v18.x.x 或更高

# 2. 检查 npm 或 pnpm
npm --version
# 或
pnpm --version

# 3. 检查 SSH（Windows 10+ 自带）
ssh -V
# 应该显示: OpenSSH_xxx

# 4. 检查 scp（Windows 10+ 自带）
scp
# 如果显示用法说明，说明可用

# 5. 检查 tar（Windows 10+ 自带）
tar --version
# 应该显示版本号
```

### 如果缺少工具

**Node.js 和 pnpm：**
```powershell
# 下载并安装 Node.js
# https://nodejs.org/

# 安装后，安装 pnpm
npm install -g pnpm
```

**SSH/SCP（如果没有）：**
- Windows 10 1809 以后自带 OpenSSH
- 如果没有，可以安装 Git for Windows（包含 Git Bash）
- 或者启用 Windows 的 OpenSSH 客户端功能

**启用 OpenSSH（如果需要）：**
1. 打开 **设置** → **应用** → **可选功能**
2. 点击 **添加功能**
3. 搜索并安装 **OpenSSH 客户端**

---

## 3️⃣ 项目文件完整性 ✅

确保你在项目根目录，并且包含：

```
D:\SoftwareDevelopment\Project\openList__Tag_Synchronization\
├── OpenList-Frontend-main\     ← 前端代码
│   ├── src\
│   ├── package.json
│   └── ...
├── OpenList-main\               ← 后端代码
│   ├── server\
│   ├── internal\
│   ├── go.mod
│   └── ...
└── 杂项\
    └── 完整编译部署.bat        ← 部署脚本
```

**检查命令：**
```cmd
cd D:\SoftwareDevelopment\Project\openList__Tag_Synchronization
dir OpenList-Frontend-main
dir OpenList-main
dir 杂项\完整编译部署.bat
```

---

## 4️⃣ 服务器要求 ✅

### 操作系统
- Linux（推荐 Ubuntu 20.04+ / Debian 11+ / CentOS 8+）

### 最低配置
- CPU: 1 核
- 内存: 512 MB（建议 1 GB+）
- 磁盘: 2 GB 可用空间（用于编译）
- 网络: 能访问 golang.org、github.com 等（下载依赖）

### 需要安装的软件
脚本会**自动安装** Go 编译器，你不需要提前安装。

但需要确保服务器能：
- ✅ 运行 `wget` 或 `curl`（用于下载 Go）
- ✅ 解压 `tar.gz` 文件
- ✅ 运行 `systemctl`（管理服务）

---

## 5️⃣ 网络要求 ✅

### 本地到服务器
- ✅ 能 ping 通服务器
- ✅ 能 SSH 连接（端口 22）
- ✅ 能 SCP 传文件

**测试命令：**
```cmd
# 测试网络连通性
ping 70.39.205.183

# 测试 SSH 端口
telnet 70.39.205.183 22
# 或
Test-NetConnection -ComputerName 70.39.205.183 -Port 22
```

### 服务器网络
服务器需要能访问：
- ✅ `dl.google.com` 或 `golang.org`（下载 Go）
- ✅ `proxy.golang.org`（下载 Go 依赖）
- ✅ `github.com`（如果有依赖来自 GitHub）

**如果服务器在中国，可能需要配置代理或使用国内镜像。**

---

## 6️⃣ 端口要求 ✅

部署后，服务器需要开放端口：
- **5244**: OpenList Web 界面（HTTP）
- **5245**: WebDAV 服务（可选）

**检查和开放端口（在服务器上）：**

```bash
# 使用 iptables
iptables -A INPUT -p tcp --dport 5244 -j ACCEPT
iptables -A INPUT -p tcp --dport 5245 -j ACCEPT
iptables-save > /etc/iptables/rules.v4

# 使用 firewalld
firewall-cmd --permanent --add-port=5244/tcp
firewall-cmd --permanent --add-port=5245/tcp
firewall-cmd --reload

# 使用 ufw
ufw allow 5244/tcp
ufw allow 5245/tcp
```

---

## 🚀 开始部署

### 步骤 1: 确认所有准备工作完成

```cmd
☐ 能 SSH 连接到服务器
☐ 知道服务器密码
☐ 本地已安装 Node.js 和 pnpm/npm
☐ 本地已安装 SSH/SCP（Windows 10+ 自带）
☐ 在项目根目录
☐ 项目文件完整
```

### 步骤 2: 运行部署脚本

```cmd
# 在项目根目录
cd D:\SoftwareDevelopment\Project\openList__Tag_Synchronization

# 双击运行
杂项\完整编译部署.bat

# 或者在命令行运行
.\杂项\完整编译部署.bat
```

### 步骤 3: 按提示操作

脚本会多次提示你输入服务器密码：

```
1. 上传代码时          → 输入密码
2. 上传部署脚本时      → 输入密码
3. 执行远程命令时      → 输入密码
```

**为什么要输入多次密码？**
- 因为 SSH 每次连接都需要认证
- 如果不想每次输入，可以配置 SSH 密钥认证（见下方）

---

## 🔐 配置 SSH 密钥（可选，避免反复输入密码）

### 1. 生成 SSH 密钥（如果没有）

```powershell
# 在 PowerShell 中运行
ssh-keygen -t rsa -b 4096

# 按提示操作，可以直接回车使用默认设置
# 密钥会保存在: C:\Users\你的用户名\.ssh\id_rsa
```

### 2. 上传公钥到服务器

```powershell
# 方法1: 使用 ssh-copy-id（如果有）
ssh-copy-id root@70.39.205.183

# 方法2: 手动上传
type C:\Users\你的用户名\.ssh\id_rsa.pub | ssh root@70.39.205.183 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### 3. 测试免密登录

```powershell
ssh root@70.39.205.183
# 如果不需要输入密码就能登录，说明配置成功
```

配置后，部署脚本就不会反复要求输入密码了！

---

## ⏱️ 预计部署时间

- **编译前端**: 2-5 分钟（取决于网速和电脑性能）
- **上传代码**: 1-3 分钟（取决于网速）
- **编译后端**: 5-10 分钟（第一次，取决于服务器性能和网速）
- **总计**: **8-18 分钟**

**编译后端是最耗时的步骤**，因为需要：
1. 下载 Go 编译器（约 130 MB）
2. 下载 Go 依赖包
3. 编译 Go 代码

---

## 📞 遇到问题？

### 常见问题

**1. SSH 连接被拒绝**
```
解决方法：
- 检查服务器 IP 是否正确
- 检查服务器是否开启了 SSH 服务
- 检查防火墙是否允许端口 22
```

**2. 密码错误**
```
解决方法：
- 确认用户名（root 或其他）
- 确认密码正确
- 尝试通过 SSH 手动登录测试
```

**3. 编译失败**
```
解决方法：
- 检查服务器网络是否能访问 golang.org
- 检查服务器磁盘空间是否充足
- 查看详细错误日志
```

**4. 脚本找不到命令**
```
Windows 可能缺少某些工具，解决方法：
- 安装 Git for Windows（包含必要的命令行工具）
- 使用 PowerShell（Windows 10+ 推荐）
- 启用 Windows 的 OpenSSH 功能
```

---

## ✅ 准备完毕！

如果以上检查都通过了，你就可以开始部署了：

```cmd
.\杂项\完整编译部署.bat
```

部署成功后访问：
- **http://70.39.205.183:5244**

祝部署顺利！🎉

---

## 📝 快速命令速查表

```powershell
# 测试 SSH 连接
ssh root@70.39.205.183

# 测试端口连通性
Test-NetConnection -ComputerName 70.39.205.183 -Port 22

# 查看服务状态（部署后）
ssh root@70.39.205.183 "systemctl status openlist-custom"

# 查看服务日志（部署后）
ssh root@70.39.205.183 "journalctl -u openlist-custom -f"

# 重启服务（部署后）
ssh root@70.39.205.183 "systemctl restart openlist-custom"
```

