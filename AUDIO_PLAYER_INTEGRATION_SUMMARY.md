# éŸ³é¢‘æ’­æ”¾å™¨æ”¶è—å’Œæ ‡è®°åŠŸèƒ½å¯¹æ¥æ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½å¯¹æ¥

### 1. æ·»åŠ åˆ°æ”¶è—åŠŸèƒ½ â¤ï¸

**å¯¹æ¥å†…å®¹**:
- ä½¿ç”¨ä¸éŸ³é¢‘å±•ç¤ºç•Œé¢ç›¸åŒçš„æ”¶è—API
- è°ƒç”¨ `listAudioFavoriteFolders()` åŠ è½½æ”¶è—æ–‡ä»¶å¤¹
- è°ƒç”¨ `createAudioFavoriteFolder()` åˆ›å»ºæ–°æ–‡ä»¶å¤¹
- è°ƒç”¨ `createAudioFavorite()` æ·»åŠ éŸ³é¢‘åˆ°æ”¶è—

**åŠŸèƒ½ç‰¹æ€§**:
- **é€‰æ‹©æ–‡ä»¶å¤¹**: ä»ç°æœ‰æ”¶è—æ–‡ä»¶å¤¹ä¸­é€‰æ‹©
- **åˆ›å»ºæ–‡ä»¶å¤¹**: æ”¯æŒåˆ›å»ºæ–°çš„æ”¶è—æ–‡ä»¶å¤¹
- **æ·»åŠ å¤‡æ³¨**: å¯é€‰çš„å¤‡æ³¨ä¿¡æ¯
- **ç™»å½•æ£€æŸ¥**: éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨
- **çŠ¶æ€æ£€æŸ¥**: éœ€è¦æœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘

**ä½¿ç”¨æµç¨‹**:
1. ç‚¹å‡»"â¤ï¸ æ·»åŠ åˆ°æ”¶è—"æŒ‰é’®
2. é€‰æ‹©æ”¶è—æ–‡ä»¶å¤¹ï¼ˆæˆ–åˆ›å»ºæ–°æ–‡ä»¶å¤¹ï¼‰
3. å¯é€‰æ·»åŠ å¤‡æ³¨
4. ç‚¹å‡»"ç¡®è®¤æ·»åŠ "

### 2. æ·»åŠ æ ‡è®°åŠŸèƒ½ ğŸ·ï¸

**å¯¹æ¥å†…å®¹**:
- ä½¿ç”¨ä¸éŸ³é¢‘å±•ç¤ºç•Œé¢ç›¸åŒçš„æ ‡è®°API
- è°ƒç”¨ `createMediaMark()` åˆ›å»ºåª’ä½“æ ‡è®°
- è‡ªåŠ¨è®°å½•å½“å‰æ’­æ”¾æ—¶é—´ç‚¹

**åŠŸèƒ½ç‰¹æ€§**:
- **æ ‡è®°æ ‡é¢˜**: å¿…å¡«é¡¹ï¼Œæ ‡è®°çš„åç§°
- **æ ‡è®°å†…å®¹**: å¯é€‰ï¼Œè¯¦ç»†æè¿°
- **æ—¶é—´è®°å½•**: è‡ªåŠ¨è®°å½•å½“å‰æ’­æ”¾æ—¶é—´
- **ç™»å½•æ£€æŸ¥**: éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨
- **çŠ¶æ€æ£€æŸ¥**: éœ€è¦æœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘

**ä½¿ç”¨æµç¨‹**:
1. ç‚¹å‡»"ğŸ·ï¸ æ·»åŠ æ ‡è®°"æŒ‰é’®
2. è¾“å…¥æ ‡è®°æ ‡é¢˜
3. å¯é€‰è¾“å…¥æ ‡è®°å†…å®¹
4. ç³»ç»Ÿè‡ªåŠ¨è®°å½•å½“å‰æ’­æ”¾æ—¶é—´
5. ç‚¹å‡»"æ·»åŠ æ ‡è®°"

## ğŸ® ç”¨æˆ·ç•Œé¢

### æ’­æ”¾å™¨é¡¶éƒ¨æŒ‰é’®
```
[â¤ï¸ æ·»åŠ åˆ°æ”¶è—] [ğŸ·ï¸ æ·»åŠ æ ‡è®°]
       â†“                â†“
   æ‰“å¼€æ”¶è—æ¨¡æ€æ¡†    æ‰“å¼€æ ‡è®°æ¨¡æ€æ¡†
```

### æ·»åŠ åˆ°æ”¶è—æ¨¡æ€æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·»åŠ éŸ³é¢‘åˆ°æ”¶è—              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©æ”¶è—æ–‡ä»¶å¤¹              â”‚
â”‚ [ä¸‹æ‹‰é€‰æ‹©æ¡†]                â”‚
â”‚ [+ æ–°å»ºæ”¶è—æ–‡ä»¶å¤¹]          â”‚
â”‚                             â”‚
â”‚ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰                â”‚
â”‚ [æ–‡æœ¬è¾“å…¥æ¡†]                â”‚
â”‚                             â”‚
â”‚         [ç¡®è®¤æ·»åŠ ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ·»åŠ æ ‡è®°æ¨¡æ€æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·»åŠ éŸ³é¢‘æ ‡è®°                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ ‡è®°æ ‡é¢˜                    â”‚
â”‚ [æ–‡æœ¬è¾“å…¥æ¡†]                â”‚
â”‚                             â”‚
â”‚ æ ‡è®°å†…å®¹ï¼ˆå¯é€‰ï¼‰            â”‚
â”‚ [å¤šè¡Œæ–‡æœ¬æ¡†]                â”‚
â”‚                             â”‚
â”‚ å½“å‰æ—¶é—´: 125 ç§’            â”‚
â”‚                             â”‚
â”‚   [å–æ¶ˆ]    [æ·»åŠ æ ‡è®°]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯å®ç°

### å¯¼å…¥çš„å·¥å…·å‡½æ•°
```typescript
import {
  listAudioFavoriteFolders,
  createAudioFavoriteFolder,
  createAudioFavorite,
} from "~/utils/audio-favorites"
import { createMediaMark } from "~/utils/media-marks"
```

### æ”¶è—åŠŸèƒ½å®ç°
```typescript
const handleConfirmAddToFavorite = async () => {
  const currentItem = playlistState.items[playlistState.currentIndex]
  
  await createAudioFavorite({
    folder_id: selectedFolderId()!,
    storage_id: 0,
    original_path: currentItem.path,
    file_name: currentItem.name,
    note: favoriteNote(),
    fingerprint: currentItem.path,
  })
  
  notify.success(`å·²æ·»åŠ  "${currentItem.name}" åˆ°æ”¶è—`)
}
```

### æ ‡è®°åŠŸèƒ½å®ç°
```typescript
const handleConfirmAddMark = async () => {
  const currentItem = playlistState.items[playlistState.currentIndex]
  const currentTime = ap ? ap.audio.currentTime : 0
  
  await createMediaMark(currentItem.path, {
    time_second: currentTime,
    title: markTitle(),
    content: markContent()
  })
  
  notify.success(`å·²ä¸º "${currentItem.name}" æ·»åŠ æ ‡è®°`)
}
```

## ğŸ“‹ çŠ¶æ€ç®¡ç†

### æ”¶è—ç›¸å…³çŠ¶æ€
```typescript
const [folders, setFolders] = createSignal<AudioFavoriteFolder[]>([])
const [selectedFolderId, setSelectedFolderId] = createSignal<number | null>(null)
const [favoriteNote, setFavoriteNote] = createSignal("")
const [newFolderName, setNewFolderName] = createSignal("")
const [newFolderDesc, setNewFolderDesc] = createSignal("")
```

### æ ‡è®°ç›¸å…³çŠ¶æ€
```typescript
const [markTitle, setMarkTitle] = createSignal("")
const [markContent, setMarkContent] = createSignal("")
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

1. **å®Œå…¨å¯¹æ¥**: ä½¿ç”¨ä¸éŸ³é¢‘å±•ç¤ºç•Œé¢å®Œå…¨ç›¸åŒçš„API
2. **ç”¨æˆ·å‹å¥½**: æ¸…æ™°çš„æ¨¡æ€æ¡†ç•Œé¢å’Œæ“ä½œæµç¨‹
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’ŒéªŒè¯
4. **çŠ¶æ€ç®¡ç†**: å“åº”å¼çŠ¶æ€æ›´æ–°
5. **ç™»å½•ä¿æŠ¤**: éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨åŠŸèƒ½

## ğŸ” ä½¿ç”¨åœºæ™¯

### æ”¶è—åœºæ™¯
- æ”¶è—å–œæ¬¢çš„éŸ³é¢‘åˆ°ä¸åŒæ–‡ä»¶å¤¹
- ä¸ºæ”¶è—æ·»åŠ å¤‡æ³¨è¯´æ˜
- ç®¡ç†ä¸ªäººéŸ³é¢‘æ”¶è—åº“

### æ ‡è®°åœºæ™¯
- åœ¨éŸ³é¢‘çš„ç‰¹å®šæ—¶é—´ç‚¹æ·»åŠ æ ‡è®°
- è®°å½•é‡è¦å†…å®¹æˆ–æƒ³æ³•
- å¿«é€Ÿå®šä½éŸ³é¢‘ä¸­çš„å…³é”®éƒ¨åˆ†

æ‰€æœ‰åŠŸèƒ½éƒ½å·²å®Œå…¨å¯¹æ¥å¹¶å¯æ­£å¸¸ä½¿ç”¨ï¼ğŸ‰
