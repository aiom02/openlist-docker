# ä¿®å¤éŸ³é¢‘æ’­æ”¾é—®é¢˜ - å®Œæ•´æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æ ¹å› 

æœåŠ¡å™¨éƒ¨ç½²çš„å‰ç«¯ Nginx é…ç½®**ç¼ºå°‘ `/d/` è·¯å¾„çš„ä»£ç†**ï¼Œå¯¼è‡´ï¼š
- éŸ³é¢‘/è§†é¢‘ä¸‹è½½è¯·æ±‚è¿”å› HTML é¡µé¢è€Œä¸æ˜¯æ–‡ä»¶
- æ’­æ”¾å™¨æ— æ³•è·å–éŸ³é¢‘æµï¼Œæ˜¾ç¤º "An audio error has occurred"

## âœ… è§£å†³æ–¹æ¡ˆ

å·²ä¿®å¤ `Dockerfile.frontend`ï¼Œæ·»åŠ äº†ä»¥ä¸‹å…³é”®é…ç½®ï¼š

### æ–°å¢çš„ä»£ç†è§„åˆ™

```nginx
# éŸ³é¢‘/è§†é¢‘ä¸‹è½½æµå¼ä¼ è¾“ï¼ˆå…³é”®ï¼ï¼‰
location /d/ {
    proxy_pass http://openlist-backend:5244;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_buffering off;           # ç¦ç”¨ç¼“å†²ï¼Œæ”¯æŒæµå¼ä¼ è¾“
    proxy_request_buffering off;   # ç¦ç”¨è¯·æ±‚ç¼“å†²
}

# WebDAV æ”¯æŒ
location /dav/ {
    proxy_pass http://openlist-backend:5244;
    ...
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šé‡æ–°æ„å»ºé•œåƒ

åœ¨**æœ¬åœ° Windows** ä¸Šæ‰§è¡Œï¼š

```batch
1-æ„å»ºé•œåƒ-æ¸…ç†ç‰ˆ.bat
```

è¿™ä¼šï¼š
1. æ¸…ç†æ—§çš„æ„å»ºç¼“å­˜
2. é‡æ–°æ„å»ºå‰ç«¯ï¼ˆåŒ…å«ä¿®å¤çš„ Nginx é…ç½®ï¼‰
3. æ„å»ºåç«¯
4. ç”Ÿæˆæ–°çš„é•œåƒ

### ç¬¬äºŒæ­¥ï¼šå¯¼å‡ºé•œåƒ

```batch
2-å¯¼å‡ºé•œåƒ.bat
```

ä¼šåœ¨ `docker-images` ç›®å½•ç”Ÿæˆï¼š
- `openlist-backend.tar`ï¼ˆåç«¯æ²¡å˜ï¼Œå¯ä»¥ä¸ä¸Šä¼ ï¼‰
- `openlist-frontend.tar`ï¼ˆ**å¿…é¡»ä¸Šä¼ **ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

åªéœ€ä¸Šä¼ ä¿®å¤åçš„å‰ç«¯é•œåƒï¼š

```powershell
# åœ¨æœ¬åœ° PowerShell æ‰§è¡Œ
scp docker-images\openlist-frontend.tar root@70.39.205.183:/opt/openlist/
```

### ç¬¬å››æ­¥ï¼šæœåŠ¡å™¨ç«¯æ›´æ–°

SSH è¿æ¥åˆ°æœåŠ¡å™¨åæ‰§è¡Œï¼š

```bash
# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /opt/openlist

# åœæ­¢å¹¶åˆ é™¤å‰ç«¯å®¹å™¨
docker stop openlist-frontend
docker rm openlist-frontend

# åˆ é™¤æ—§çš„å‰ç«¯é•œåƒ
docker rmi openlist-frontend:latest

# åŠ è½½æ–°çš„å‰ç«¯é•œåƒ
docker load -i openlist-frontend.tar

# é‡æ–°å¯åŠ¨å‰ç«¯å®¹å™¨
docker run -d \
  --name openlist-frontend \
  --network openlist-network \
  -p 66:80 \
  --restart unless-stopped \
  openlist-frontend:latest

# éªŒè¯å®¹å™¨çŠ¶æ€
docker ps
```

### ç¬¬äº”æ­¥ï¼šéªŒè¯ä¿®å¤

```bash
# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker logs -f openlist-frontend

# æµ‹è¯•éŸ³é¢‘è¯·æ±‚
curl -I http://localhost:66/d/test.mp3
# åº”è¯¥è¿”å› 302 æˆ– 404ï¼Œè€Œä¸æ˜¯ 200 HTML
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€æµè§ˆå™¨**ï¼š`http://70.39.205.183:66`

2. **æ’­æ”¾éŸ³é¢‘æ–‡ä»¶**ï¼š
   - è¿›å…¥éŸ³ä¹æµ‹è¯•æ–‡ä»¶å¤¹
   - ç‚¹å‡»éŸ³é¢‘æ–‡ä»¶
   - åº”è¯¥èƒ½æ­£å¸¸æ’­æ”¾

3. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**ï¼š
   - æ‰“å¼€ F12 å¼€å‘è€…å·¥å…·
   - Network æ ‡ç­¾
   - ç‚¹å‡»æ’­æ”¾éŸ³é¢‘
   - æŸ¥çœ‹ `/d/` å¼€å¤´çš„è¯·æ±‚
   - åº”è¯¥çœ‹åˆ° `302 Found` ç„¶åé‡å®šå‘åˆ°é˜¿é‡Œäº‘ç›´é“¾

4. **é¢„æœŸç»“æœ**ï¼š
   - âœ… éŸ³é¢‘æ’­æ”¾å™¨æ­£å¸¸æ˜¾ç¤º
   - âœ… å¯ä»¥æ’­æ”¾ã€æš‚åœã€åˆ‡æ¢æ­Œæ›²
   - âœ… è§†é¢‘ä¹Ÿèƒ½æ­£å¸¸æ’­æ”¾

---

## ğŸ“‹ å¿«é€Ÿæ›´æ–°è„šæœ¬

æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¿«é€Ÿæ›´æ–°è„šæœ¬ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
#!/bin/bash
# å¿«é€Ÿæ›´æ–°å‰ç«¯é•œåƒ

echo "åœæ­¢å‰ç«¯å®¹å™¨..."
docker stop openlist-frontend
docker rm openlist-frontend

echo "åˆ é™¤æ—§é•œåƒ..."
docker rmi openlist-frontend:latest

echo "åŠ è½½æ–°é•œåƒ..."
docker load -i /opt/openlist/openlist-frontend.tar

echo "å¯åŠ¨å‰ç«¯å®¹å™¨..."
docker run -d \
  --name openlist-frontend \
  --network openlist-network \
  -p 66:80 \
  --restart unless-stopped \
  openlist-frontend:latest

echo "å®Œæˆï¼"
docker ps | grep openlist-frontend
```

---

## ğŸ”§ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šç›´æ¥è®¿é—®åç«¯

å¦‚æœæ›´æ–°åéŸ³é¢‘è¿˜æ˜¯æ— æ³•æ’­æ”¾ï¼Œå¯ä»¥ä¸´æ—¶ç›´æ¥é€šè¿‡åç«¯è®¿é—®ï¼š

```
http://70.39.205.183:5244
```

**æ³¨æ„**ï¼šéœ€è¦åœ¨äº‘æœåŠ¡å•†å®‰å…¨ç»„å¼€æ”¾ 5244 ç«¯å£ã€‚

### æ£€æŸ¥åç«¯æ—¥å¿—

```bash
docker logs -f openlist-backend
```

å½“ç‚¹å‡»æ’­æ”¾éŸ³é¢‘æ—¶ï¼Œåº”è¯¥èƒ½çœ‹åˆ° `/d/` è¯·æ±‚çš„æ—¥å¿—ã€‚

### éªŒè¯ Nginx é…ç½®

```bash
# è¿›å…¥å‰ç«¯å®¹å™¨
docker exec -it openlist-frontend sh

# æŸ¥çœ‹ Nginx é…ç½®
cat /etc/nginx/conf.d/default.conf

# åº”è¯¥çœ‹åˆ° location /d/ çš„é…ç½®
```

---

## ğŸ“Š é…ç½®å¯¹æ¯”

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
location /api {
    proxy_pass http://openlist-backend:5244;
}
# âŒ ç¼ºå°‘ /d/ ä»£ç†
```

**ç»“æœ**ï¼š`/d/` è¯·æ±‚è¢«å½“ä½œå‰ç«¯è·¯ç”±ï¼Œè¿”å› HTML

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰

```nginx
location /api {
    proxy_pass http://openlist-backend:5244;
}
location /d/ {
    proxy_pass http://openlist-backend:5244;  # âœ… æ·»åŠ 
    proxy_buffering off;
}
location /dav/ {
    proxy_pass http://openlist-backend:5244;  # âœ… æ·»åŠ 
}
location / {
    try_files $uri $uri/ /index.html;
}
```

**ç»“æœ**ï¼š`/d/` è¯·æ±‚æ­£ç¡®ä»£ç†åˆ°åç«¯ï¼Œè¿”å› 302 é‡å®šå‘

---

## ğŸ¯ å…³é”®çŸ¥è¯†ç‚¹

### OpenList çš„è·¯å¾„ç»“æ„

| è·¯å¾„ | ç”¨é€” | å¤„ç†æ–¹å¼ |
|------|------|---------|
| `/api/*` | API è¯·æ±‚ | ä»£ç†åˆ°åç«¯ |
| `/d/*` | **æ–‡ä»¶ä¸‹è½½/æµå¼ä¼ è¾“** | **å¿…é¡»ä»£ç†åˆ°åç«¯** âš ï¸ |
| `/dav/*` | WebDAV | ä»£ç†åˆ°åç«¯ |
| `/p/*` | é¢„è§ˆ | ä»£ç†åˆ°åç«¯ |
| `/*` | å…¶ä»–è·¯å¾„ | å‰ç«¯ SPA è·¯ç”± |

### ä¸ºä»€ä¹ˆæœ¬åœ°èƒ½æ’­æ”¾ï¼Ÿ

æœ¬åœ°å¼€å‘æ—¶ï¼š
- å‰ç«¯ï¼š`http://localhost:5174`ï¼ˆVite å¼€å‘æœåŠ¡å™¨ï¼‰
- åç«¯ï¼š`http://localhost:5244`

å‰ç«¯ç›´æ¥è¯·æ±‚ `localhost:5244/d/...`ï¼Œä¸ç»è¿‡ Nginx ä»£ç†ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ã€‚

æœåŠ¡å™¨éƒ¨ç½²åï¼š
- å‰ç«¯ Nginx å¿…é¡»æ­£ç¡®é…ç½®ä»£ç†ï¼Œå¦åˆ™ `/d/` è¢«å½“ä½œå‰ç«¯è·¯ç”±ã€‚

---

## ğŸ‰ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼š
- âœ… éŸ³é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾
- âœ… è§†é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾
- âœ… æ­Œè¯åŒæ­¥æ˜¾ç¤º
- âœ… è¿›åº¦æ¡æ­£å¸¸æ‹–åŠ¨
- âœ… åˆ—è¡¨åˆ‡æ¢æ­£å¸¸

---

## ğŸ“ å¦‚æœé‡åˆ°é—®é¢˜

1. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**ï¼š
   ```bash
   docker ps
   ```

2. **æŸ¥çœ‹å‰ç«¯æ—¥å¿—**ï¼š
   ```bash
   docker logs openlist-frontend
   ```

3. **æŸ¥çœ‹åç«¯æ—¥å¿—**ï¼š
   ```bash
   docker logs openlist-backend
   ```

4. **æµè§ˆå™¨æ§åˆ¶å°**ï¼š
   - F12 â†’ Network æ ‡ç­¾
   - çœ‹ `/d/` è¯·æ±‚çš„çŠ¶æ€ç 
   - åº”è¯¥æ˜¯ `302 Found`ï¼Œè€Œä¸æ˜¯ `200 OK (HTML)`

---

## ğŸš€ å¼€å§‹ä¿®å¤å§ï¼

æ‰§è¡Œé¡ºåºï¼š
1. æœ¬åœ°è¿è¡Œ `1-æ„å»ºé•œåƒ-æ¸…ç†ç‰ˆ.bat`
2. æœ¬åœ°è¿è¡Œ `2-å¯¼å‡ºé•œåƒ.bat`
3. ä¸Šä¼  `openlist-frontend.tar` åˆ°æœåŠ¡å™¨
4. æœåŠ¡å™¨æ‰§è¡Œæ›´æ–°å‘½ä»¤
5. æµ‹è¯•éŸ³é¢‘æ’­æ”¾

**é¢„è®¡æ—¶é—´**ï¼š10-15 åˆ†é’Ÿ

ç¥ä¿®å¤æˆåŠŸï¼ğŸµ

