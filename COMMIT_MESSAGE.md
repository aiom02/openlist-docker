# feat: å®ç°å®Œæ•´çš„éŸ³é¢‘æ’­æ”¾å™¨åŠŸèƒ½åŠUIä¼˜åŒ–

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. éŸ³é¢‘æ’­æ”¾å™¨æ ¸å¿ƒåŠŸèƒ½
- âœ… å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨ç»„ä»¶ (GlobalAudioPlayer)
- âœ… æ’­æ”¾åˆ—è¡¨ç®¡ç†ï¼ˆæ·»åŠ ã€åˆ é™¤ã€æ‰¹é‡åˆ é™¤ã€æ‹–æ‹½æ’åºã€æ¸…ç©ºï¼‰
- âœ… æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš‚åœã€ä¸Šä¸€æ›²/ä¸‹ä¸€æ›²ã€å¿«è¿›/å¿«é€€ï¼‰
- âœ… æ’­æ”¾æ¨¡å¼åˆ‡æ¢ï¼ˆåˆ—è¡¨å¾ªç¯ã€éšæœºæ’­æ”¾ã€å•æ›²å¾ªç¯ï¼‰
- âœ… ç¡çœ å®šæ—¶åŠŸèƒ½
- âœ… å¿«è¿›å¿«é€€ç§’æ•°è‡ªå®šä¹‰è®¾ç½®
- âœ… æ’­æ”¾çŠ¶æ€æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
- âœ… åŒå‘æ’­æ”¾åˆ—è¡¨åŒæ­¥ï¼ˆAPlayerå†…ç½®åˆ—è¡¨ â†” è‡ªå®šä¹‰åˆ—è¡¨ï¼‰

### 2. æ”¶è—å’Œæ ‡è®°åŠŸèƒ½
- âœ… éŸ³é¢‘æ”¶è—åŠŸèƒ½ï¼ˆæ·»åŠ åˆ°æ”¶è—æ–‡ä»¶å¤¹ï¼‰
- âœ… æ”¶è—æ–‡ä»¶å¤¹ç®¡ç†ï¼ˆåˆ›å»ºã€é€‰æ‹©ï¼‰
- âœ… éŸ³é¢‘æ ‡è®°åŠŸèƒ½ï¼ˆæ·»åŠ æ—¶é—´æ ‡è®°å’Œå¤‡æ³¨ï¼‰
- âœ… æŒ‡çº¹ç”Ÿæˆï¼ˆFNV-1a hashç®—æ³•ï¼‰
- âœ… è·¯å¾„å¤„ç†ï¼ˆæ”¯æŒç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„ï¼‰

### 3. åå°æ’­æ”¾åŠŸèƒ½
- âœ… Media Session API é›†æˆ
- âœ… é”å±/åå°æ’­æ”¾æ”¯æŒ
- âœ… ç³»ç»Ÿé€šçŸ¥æ æ§åˆ¶
- âœ… è“ç‰™è®¾å¤‡æ§åˆ¶æ”¯æŒ
- âœ… å…ƒæ•°æ®æ˜¾ç¤ºï¼ˆæ ‡é¢˜ã€è‰ºæœ¯å®¶ã€å°é¢ï¼‰
- âœ… çŠ¶æ€æŒä¹…åŒ–

### 4. UI/UX ä¼˜åŒ–
- âœ… æš—é»‘æ¨¡å¼å®Œæ•´é€‚é…ï¼ˆAPlayerç»„ä»¶ï¼‰
- âœ… æ’­æ”¾å™¨å¸ƒå±€ä¼˜åŒ–ï¼ˆæŒ‰é’®åˆ†ç»„ã€å±…ä¸­å¯¹é½ï¼‰
- âœ… ç®€åŒ–ç‰ˆå·¥å…·æ ï¼ˆç”¨äºç‰¹æ®Šé¡µé¢ï¼‰
- âœ… å³ä¸‹è§’å·¥å…·æ åœ¨æ‰€æœ‰é¡µé¢æ˜¾ç¤º
- âœ… åº•éƒ¨ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
- âœ… å›¾æ ‡ä¼˜åŒ–ï¼ˆæ’­æ”¾å™¨å›¾æ ‡æ”¹ä¸ºæ’­æ”¾é”®ï¼‰
- âœ… ä¸­è‹±æ–‡ç¿»è¯‘æ”¯æŒ

### 5. è·¯ç”±å’Œå¯¼èˆª
- âœ… ç‹¬ç«‹éŸ³é¢‘æ’­æ”¾å™¨é¡µé¢ (/audio-player)
- âœ… å·¦ä¸Šè§’è¿”å›æŒ‰é’®
- âœ… å·¥å…·æ è¿”å›åŠŸèƒ½
- âœ… é¡µé¢é—´å¯¼èˆªä¼˜åŒ–

---

## ğŸ› é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: æ”¶è—éŸ³é¢‘æ— æ³•æ­£ç¡®è·³è½¬
**é—®é¢˜æè¿°**: ä»éŸ³é¢‘æ’­æ”¾å™¨æ”¶è—çš„éŸ³é¢‘ï¼Œåœ¨"æˆ‘çš„æ”¶è—"é¡µé¢ç‚¹å‡»åæ— æ³•è·³è½¬ï¼Œæç¤º"storage not found"

**åŸå› åˆ†æ**:
- PlaylistItem ä¸­å­˜å‚¨çš„ path æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `\jok\åœ°é“\xxx.mp3`ï¼‰
- ç¼ºå°‘ storage å‰ç¼€ï¼ˆå¦‚ `/é˜¿é‡Œ/jok/åœ°é“/xxx.mp3`ï¼‰
- fingerprint ä½¿ç”¨äº†é”™è¯¯çš„ç”Ÿæˆæ–¹å¼

**è§£å†³æ–¹æ¡ˆ**:
1. ä¿®æ”¹ `PlaylistItem` æ¥å£ï¼Œæ·»åŠ  `storage_id` å’Œ `size` å­—æ®µ
2. åœ¨ `audio.tsx` çš„ `handleAddToPlaylist` ä¸­æ„å»ºå®Œæ•´è·¯å¾„ï¼š
   ```typescript
   // å¤„ç†Windowsé£æ ¼çš„ç›¸å¯¹è·¯å¾„
   if (currentObj.path.startsWith('\\')) {
     const pathParts = pathname().split('/').filter(p => p)
     const storageName = pathParts[0] || ''
     const normalizedPath = currentObj.path.replace(/\\/g, '/')
     fullPath = `/${storageName}${normalizedPath}`
   }
   ```
3. ä½¿ç”¨ FNV-1a hash ç®—æ³•ç”Ÿæˆæ­£ç¡®çš„ fingerprintï¼š
   ```typescript
   const str = `${currentItem.name}_${currentItem.size}`
   let hash = 2166136261
   for (let i = 0; i < str.length; i++) {
     hash ^= str.charCodeAt(i)
     hash = Math.imul(hash, 16777619)
   }
   fingerprint = (hash >>> 0).toString(16).padStart(8, '0')
   ```

### é—®é¢˜2: æ’­æ”¾åˆ—è¡¨ä¸åŒæ­¥
**é—®é¢˜æè¿°**: APlayerå†…ç½®åˆ—è¡¨å’Œè‡ªå®šä¹‰åˆ—è¡¨ä¸èƒ½åŒå‘åŒæ­¥

**åŸå› åˆ†æ**:
- åªå®ç°äº†è‡ªå®šä¹‰åˆ—è¡¨ â†’ APlayer çš„å•å‘åŒæ­¥
- ç¼ºå°‘ APlayer â†’ è‡ªå®šä¹‰åˆ—è¡¨çš„äº‹ä»¶ç›‘å¬

**è§£å†³æ–¹æ¡ˆ**:
æ·»åŠ  `listswitch` äº‹ä»¶ç›‘å¬å™¨ï¼š
```typescript
ap.on("listswitch", (index: any) => {
  if (!isInternalUpdate()) {
    setPlaylistState("currentIndex", index.index)
  }
})
```

### é—®é¢˜3: æš—é»‘æ¨¡å¼æ˜¾ç¤ºä¸å®Œæ•´
**é—®é¢˜æè¿°**: APlayerç»„ä»¶åœ¨æš—é»‘æ¨¡å¼ä¸‹éƒ¨åˆ†åŒºåŸŸä»æ˜¾ç¤ºç™½è‰²èƒŒæ™¯

**åŸå› åˆ†æ**:
- APlayer çš„é»˜è®¤æ ·å¼ä¼˜å…ˆçº§é«˜
- ç¼ºå°‘å®Œæ•´çš„æš—é»‘æ¨¡å¼CSSè¦†ç›–

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»º `GlobalAudioPlayer.css` æ–‡ä»¶
2. ä½¿ç”¨ `!important` ç¡®ä¿æ ·å¼ä¼˜å…ˆçº§
3. æ·»åŠ ä¸»é¢˜ç›‘å¬ï¼ŒåŠ¨æ€æ·»åŠ  `aplayer-dark` ç±»ï¼š
   ```typescript
   createEffect(() => {
     const isDark = colorMode() === "dark"
     if (playerContainer) {
       if (isDark) {
         playerContainer.classList.add("aplayer-dark")
       } else {
         playerContainer.classList.remove("aplayer-dark")
       }
     }
   })
   ```

### é—®é¢˜4: å·¥å…·æ åœ¨ç‰¹æ®Šé¡µé¢ä¸å¯ç”¨
**é—®é¢˜æè¿°**: æ”¶è—ã€æ ‡è®°ã€æ’­æ”¾å™¨é¡µé¢çš„ `usePath` hook ä¸å¯ç”¨ï¼Œå¯¼è‡´å·¥å…·æ æ— æ³•æ˜¾ç¤º

**åŸå› åˆ†æ**:
- `usePath` hook åªåœ¨æ–‡ä»¶æµè§ˆé¡µé¢å¯ç”¨
- å®Œæ•´å·¥å…·æ ä¾èµ– `usePath` çš„ refresh åŠŸèƒ½

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»º `SimpleRightToolbar` ç»„ä»¶
2. ä½¿ç”¨ try-catch åŒ…è£… `usePath`ï¼Œé™çº§ä¸º `window.location.reload()`ï¼š
   ```typescript
   let refresh: (() => void)
   try {
     const pathHook = usePath()
     refresh = () => pathHook.refresh(undefined, true)
   } catch (e) {
     refresh = () => window.location.reload()
   }
   ```
3. åœ¨ç‰¹æ®Šé¡µé¢ä½¿ç”¨ç®€åŒ–ç‰ˆå·¥å…·æ 

### é—®é¢˜5: TypeScript ç±»å‹é”™è¯¯
**é—®é¢˜æè¿°**: 
- `ç±»å‹"Me"ä¸Šä¸å­˜åœ¨å±æ€§"guest"`
- å¯¼å…¥é‡å¤ï¼ˆShow, Forï¼‰

**è§£å†³æ–¹æ¡ˆ**:
1. ç§»é™¤ guest æ£€æŸ¥ï¼Œæ”¹ç”¨ `user && user.id`
2. ç¡®ä¿ Show å’Œ For åªä» `solid-js` å¯¼å…¥ï¼Œä¸ä» `@hope-ui/solid` å¯¼å…¥

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- `src/components/GlobalAudioPlayer.tsx` - å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨ç»„ä»¶
- `src/components/GlobalAudioPlayer.css` - æš—é»‘æ¨¡å¼æ ·å¼
- `src/components/SimpleRightToolbar.tsx` - ç®€åŒ–ç‰ˆå·¥å…·æ 
- `src/store/playlist.ts` - æ’­æ”¾åˆ—è¡¨çŠ¶æ€ç®¡ç†
- `src/pages/audio-player/index.tsx` - ç‹¬ç«‹æ’­æ”¾å™¨é¡µé¢

### ä¿®æ”¹æ–‡ä»¶
- `src/pages/home/previews/audio.tsx` - æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨åŠŸèƒ½ï¼Œè·¯å¾„å¤„ç†
- `src/pages/home/toolbar/Right.tsx` - æ·»åŠ è¿”å›å’Œä¸»é¢˜åˆ‡æ¢æŒ‰é’®
- `src/pages/home/Footer.tsx` - åº•éƒ¨ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
- `src/pages/audio-favorites/index.tsx` - æ·»åŠ å·¥å…·æ 
- `src/pages/media-marks/index.tsx` - æ·»åŠ å·¥å…·æ 
- `src/pages/favorites/index.tsx` - æ·»åŠ å·¥å…·æ 
- `src/lang/en/home.json` - è‹±æ–‡ç¿»è¯‘
- `src/lang/zh-cn/home.json` - ä¸­æ–‡ç¿»è¯‘

---

## ğŸ”§ æŠ€æœ¯æ ˆ

- **UIæ¡†æ¶**: Solid.js + Hope UI
- **éŸ³é¢‘æ’­æ”¾**: APlayer
- **çŠ¶æ€ç®¡ç†**: Solid.js Signals + Store
- **è·¯ç”±**: @solidjs/router
- **å›¾æ ‡**: solid-icons
- **åŠ¨ç”»**: solid-motionone
- **API**: Media Session API
- **æŒä¹…åŒ–**: localStorage

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

- æ–°å¢ä»£ç : ~2000+ è¡Œ
- ä¿®æ”¹ä»£ç : ~500+ è¡Œ
- æ–°å¢ç»„ä»¶: 5ä¸ª
- æ–°å¢åŠŸèƒ½: 20+
- ä¿®å¤é—®é¢˜: 5ä¸ª

---

## âœ… æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
- âœ… æ’­æ”¾åˆ—è¡¨å¢åˆ æ”¹æŸ¥
- âœ… æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš‚åœ/åˆ‡æ¢ï¼‰
- âœ… æ’­æ”¾æ¨¡å¼åˆ‡æ¢
- âœ… ç¡çœ å®šæ—¶
- âœ… æ”¶è—å’Œæ ‡è®°
- âœ… åå°æ’­æ”¾
- âœ… æš—é»‘æ¨¡å¼åˆ‡æ¢
- âœ… é¡µé¢å¯¼èˆª

### å…¼å®¹æ€§æµ‹è¯•
- âœ… Chrome/Edge (Desktop & Mobile)
- âœ… Safari (iOS & macOS)
- âœ… Firefox (Desktop & Mobile)

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### æ·»åŠ éŸ³é¢‘åˆ°æ’­æ”¾åˆ—è¡¨
1. åœ¨æ–‡ä»¶æµè§ˆé¡µé¢æ’­æ”¾éŸ³é¢‘
2. ç‚¹å‡»"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"æŒ‰é’®
3. éŸ³é¢‘æ·»åŠ åˆ°å…¨å±€æ’­æ”¾åˆ—è¡¨

### ä½¿ç”¨æ’­æ”¾å™¨
1. ç‚¹å‡»å³ä¸‹è§’"æ›´å¤š" â†’ "éŸ³é¢‘æ’­æ”¾å™¨"
2. æˆ–ç›´æ¥è®¿é—® `/audio-player`
3. ä½¿ç”¨æ§åˆ¶æŒ‰é’®æ§åˆ¶æ’­æ”¾

### æ”¶è—éŸ³é¢‘
1. åœ¨æ’­æ”¾å™¨ä¸­ç‚¹å‡»"â¤ï¸ æ·»åŠ åˆ°æ”¶è—"
2. é€‰æ‹©æˆ–åˆ›å»ºæ”¶è—æ–‡ä»¶å¤¹
3. åœ¨"æˆ‘çš„æ”¶è—"é¡µé¢æŸ¥çœ‹

### å¯ç”¨åå°æ’­æ”¾
1. åœ¨æ’­æ”¾å™¨ä¸­ç‚¹å‡»"ğŸ“± åå°æ’­æ”¾"æŒ‰é’®
2. åˆ‡æ¢åº”ç”¨æˆ–é”å±æ—¶éŸ³ä¹ç»§ç»­æ’­æ”¾
3. é€šè¿‡é€šçŸ¥æ /é”å±ç•Œé¢æ§åˆ¶

---

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. æ·»åŠ æ­Œè¯æ˜¾ç¤ºåŠŸèƒ½
2. æ·»åŠ å‡è¡¡å™¨
3. æ·»åŠ æ’­æ”¾å†å²è®°å½•
4. æ·»åŠ æ’­æ”¾ç»Ÿè®¡
5. ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒ
6. æ·»åŠ é”®ç›˜å¿«æ·é”®
7. æ·»åŠ æ’­æ”¾é˜Ÿåˆ—ç®¡ç†

---

Co-authored-by: AI Assistant
